from astropy.constants import M_earth
from amuse.ext.star_to_ph import convert_stellar_model_to_SPH
stellar = MESA()
stellar.particles.add_particle(sun)
evol_sun = stellar.particles[0]
#evolve sun to 12 Gyrs 
# while evol_sun.radius<=o.radius:
#     print "Time=", stellar.model_time.in_(units.Myr), stellar.particles.radius.
#     in_(units.AU), stellar.particles.stellar_type
#     stellar.evolve_model()
    
    

    
target_core_mass = evol_sun.core_mass
part_of_smaller_mass=0.25
N_h = (evol_sun.mass - target_core_mass)/(part_of_smaller_mass*M_earth)
#print evol_sun
#print "Core mass:", evol_sun.core_mass.in_(units.MSun)
sph_model = convert_stellar_model_to_SPH(
evol_sun,
N_h,
with_core_particle = True,
target_core_mass = target_core_mass,
do_store_composition = False,
base_grid_options=dict(type="fcc")
)
core_particle = sph_model.core_particle.as_set()
gas_particles = sph_model.gas_particles
print "Ngas=", len(gas_particles), "Ncore=", core_particle
write_set_to_file(core_particle, "Hydro_PrimaryStar_evol_sun.amuse", "amuse",
append_to_file=False)
write_set_to_file(gas_particles, "Hydro_PrimaryStar_evol_sun.amuse", "amuse")
